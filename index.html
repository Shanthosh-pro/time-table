<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Student Planner with Drag/Resize</title>

<!-- FullCalendar core and plugins -->
<link href="https://cdn.jsdelivr.net/npm/fullcalendar@6.1.7/index.global.min.css" rel="stylesheet" />
<script src="https://cdn.jsdelivr.net/npm/fullcalendar@6.1.7/index.global.min.js"></script>

<!-- Google Material Icons for UI -->
<link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet" />

<style>
  /* Material colors and style similar to previous */
  :root {
    --primary: #1976d2;
    --primary-dark: #115293;
    --primary-light: #4791db;
    --grey-light: #f5f5f5;
    --grey-dark: #616161;
    --error: #d32f2f;
    --success: #388e3c;
  }
  body {
    margin: 0;
    font-family: 'Roboto', Arial, sans-serif;
    background: var(--grey-light);
    color: #222;
    display: flex;
    flex-direction: column;
    min-height: 100vh;
  }
  header {
    background: var(--primary);
    color: white;
    padding: 1rem 1.5rem;
    display: flex;
    flex-direction: column;
    align-items: center;
    box-shadow: 0 3px 6px rgba(0,0,0,0.2);
  }
  header h1 {
    margin: 0;
    font-weight: 500;
    font-size: 1.6rem;
  }
  nav {
    margin-top: 0.5rem;
  }
  nav button {
    background: transparent;
    border: none;
    color: white;
    font-size: 1rem;
    font-weight: 500;
    padding: 0.5rem 1.2rem;
    cursor: pointer;
    border-radius: 4px 4px 0 0;
    transition: background-color 0.2s ease;
    user-select: none;
  }
  nav button.active, nav button:hover {
    background: var(--primary-light);
    box-shadow: inset 0 -2px 0 var(--primary-dark);
  }
  main {
    flex-grow: 1;
    max-width: 960px;
    margin: 1rem auto 2rem;
    background: white;
    padding: 1rem 1.5rem;
    border-radius: 6px;
    box-shadow: 0 2px 6px rgb(0 0 0 / 0.1);
  }
  
  #calendar {
    max-width: 900px;
    margin: 0 auto;
  }
  /* To-do List Styling */
  #todo-section {
    max-width: 600px;
    margin: 0 auto;
  }
  form#todo-form {
    display: flex;
    gap: 0.5rem;
    margin-bottom: 1rem;
  }
  form#todo-form input[type=text] {
    flex-grow: 1;
    font-size: 1rem;
    padding: 0.4rem 0.6rem;
    border: 1px solid #ccc;
    border-radius: 4px;
    outline-offset: 2px;
  }
  form#todo-form button {
    background: var(--primary);
    color: white;
    border: none;
    padding: 0 1rem;
    font-size: 1.2rem;
    border-radius: 4px;
    cursor: pointer;
    display: flex;
    align-items: center;
  }
  form#todo-form button:hover {
    background: var(--primary-dark);
  }
  ul#todo-list {
    list-style: none;
    padding: 0;
    margin: 0;
  }
  ul#todo-list li {
    background: var(--grey-light);
    margin-bottom: 0.5rem;
    padding: 0.5rem 0.75rem;
    border-radius: 4px;
    display: flex;
    align-items: center;
    justify-content: space-between;
  }
  ul#todo-list li.completed span.task-text {
    text-decoration: line-through;
    color: #757575;
  }
  ul#todo-list li button.remove-btn {
    border: none;
    background: transparent;
    color: var(--error);
    cursor: pointer;
    font-size: 1.25rem;
    padding: 0 6px;
    line-height: 1;
    user-select: none;
  }
  ul#todo-list li button.remove-btn:hover {
    color: #b71c1c;
  }
  ul#todo-list li label {
    flex-grow: 1;
    cursor: pointer;
    user-select: none;
    display: flex;
    align-items: center;
    gap: 0.5rem;
  }
  ul#todo-list li input[type=checkbox] {
    cursor: pointer;
    width: 18px;
    height: 18px;
    margin: 0;
  }

  /* Responsive */
  @media (max-width: 600px) {
    nav button {
      font-size: 0.9rem;
      padding: 0.35rem 0.8rem;
    }
  }
</style>
</head>
<body>

<header>
  <h1>Student Planner</h1>
  <nav>
    <button id="tab-timetable" class="active" aria-controls="timetable-section" aria-selected="true">Timetable</button>
    <button id="tab-todo" aria-controls="todo-section" aria-selected="false">To-Do List</button>
  </nav>
</header>

<main>
  <section id="timetable-section" role="tabpanel" aria-labelledby="tab-timetable">
    <div id="calendar"></div>
  </section>

  <section id="todo-section" class="hidden" role="tabpanel" aria-labelledby="tab-todo" tabindex="0">
    <form id="todo-form" aria-label="Add new to-do task">
      <input type="text" id="todo-input" placeholder="New task" aria-required="true" aria-describedby="todo-desc" />
      <button type="submit" aria-label="Add task">
        <span class="material-icons">add</span>
      </button>
    </form>
    <ul id="todo-list" aria-live="polite" aria-relevant="additions removals"></ul>
  </section>
</main>

<script>
  // Tabs functionality
  const tabTimetable = document.getElementById('tab-timetable');
  const tabTodo = document.getElementById('tab-todo');
  const timetableSection = document.getElementById('timetable-section');
  const todoSection = document.getElementById('todo-section');

  function activateTab(tab) {
    if(tab === 'timetable'){
      tabTimetable.classList.add('active');
      tabTimetable.setAttribute('aria-selected', 'true');
      tabTodo.classList.remove('active');
      tabTodo.setAttribute('aria-selected', 'false');
      timetableSection.classList.remove('hidden');
      todoSection.classList.add('hidden');
      timetableSection.setAttribute('tabindex', '0');
      todoSection.setAttribute('tabindex', '-1');
    } else {
      tabTodo.classList.add('active');
      tabTodo.setAttribute('aria-selected', 'true');
      tabTimetable.classList.remove('active');
      tabTimetable.setAttribute('aria-selected', 'false');
      todoSection.classList.remove('hidden');
      timetableSection.classList.add('hidden');
      todoSection.setAttribute('tabindex', '0');
      timetableSection.setAttribute('tabindex', '-1');
    }
  }

  tabTimetable.addEventListener('click', () => activateTab('timetable'));
  tabTodo.addEventListener('click', () => activateTab('todo'));


  /* ------------------------ TIMETABLE with FullCalendar ------------------------ */

  // Fetch saved events from localStorage
  let savedEvents = JSON.parse(localStorage.getItem('fcEvents') || '[]');

  const calendarEl = document.getElementById('calendar');

  const calendar = new FullCalendar.Calendar(calendarEl, {
    initialView: 'timeGridWeek',
    firstDay: 0, // Sunday as first day (0-Sunday, 1-Monday)
    slotMinTime: "00:00:00",
    slotMaxTime: "24:00:00",
    editable: true,
    selectable: true,
    eventResizableFromStart: true,
    selectMirror: true,
    allDaySlot: false,
    headerToolbar: {
      left: 'prev,next today',
      center: 'title',
      right: 'timeGridWeek,timeGridDay'
    },
    events: savedEvents,
    select(info) {
      let title = prompt('Enter class or study event name:');
      if (title) {
        const newEvent = {
          id: String(Date.now()),
          title,
          start: info.startStr,
          end: info.endStr,
        };
        calendar.addEvent(newEvent);
        savedEvents.push(newEvent);
        localStorage.setItem('fcEvents', JSON.stringify(savedEvents));
      }
      calendar.unselect();
    },
    eventChange(changeInfo) {
      // Update saved event after drag/drop or resize
      const updatedEvent = changeInfo.event;
      const idx = savedEvents.findIndex(e => e.id === updatedEvent.id);
      if (idx !== -1) {
        savedEvents[idx].start = updatedEvent.start.toISOString();
        savedEvents[idx].end = updatedEvent.end ? updatedEvent.end.toISOString() : null;
        localStorage.setItem('fcEvents', JSON.stringify(savedEvents));
      }
    },
    eventRemove(removeInfo) {
      // Not needed here; use eventClick to confirm removal
    },
    eventClick(clickInfo) {
      if(confirm(`Delete event "${clickInfo.event.title}"?`)) {
        const idx = savedEvents.findIndex(e => e.id === clickInfo.event.id);
        if (idx !== -1) {
          savedEvents.splice(idx, 1);
          localStorage.setItem('fcEvents', JSON.stringify(savedEvents));
          clickInfo.event.remove();
        }
      }
    }
  });
  calendar.render();

  /* ------------------------ TO-DO LIST ------------------------ */
  const todoForm = document.getElementById('todo-form');
  const todoInput = document.getElementById('todo-input');
  const todoList = document.getElementById('todo-list');

  let todoData = JSON.parse(localStorage.getItem('todoData') || '[]');

  function saveTodo() {
    localStorage.setItem('todoData', JSON.stringify(todoData));
  }

  function renderTodo() {
    todoList.innerHTML = '';
    if(todoData.length === 0){
      const p = document.createElement('p');
      p.textContent = 'Your to-do list is empty.';
      p.style.color = '#666';
      todoList.appendChild(p);
      return;
    }
    todoData.forEach((item, index) => {
      const li = document.createElement('li');
      li.className = item.completed ? 'completed' : '';

      const label = document.createElement('label');
      
      const checkbox = document.createElement('input');
      checkbox.type = 'checkbox';
      checkbox.checked = item.completed;
      checkbox.setAttribute('aria-label', `Mark task "${item.task}" as completed`);
      checkbox.addEventListener('change', () => {
        item.completed = checkbox.checked;
        saveTodo();
        renderTodo();
      });
      label.appendChild(checkbox);

      const span = document.createElement('span');
      span.textContent = item.task;
      span.className = 'task-text';
      label.appendChild(span);

      li.appendChild(label);

      const removeBtn = document.createElement('button');
      removeBtn.className = 'remove-btn';
      removeBtn.setAttribute('aria-label', `Remove task "${item.task}"`);
      removeBtn.title = 'Remove';
      removeBtn.innerHTML = '<span class="material-icons">close</span>';
      removeBtn.addEventListener('click', () => {
        if(confirm(`Remove task "${item.task}"?`)){
          todoData.splice(index, 1);
          saveTodo();
          renderTodo();
        }
      });

      li.appendChild(removeBtn);
      todoList.appendChild(li);
    });
  }
  renderTodo();

  todoForm.addEventListener('submit', e => {
    e.preventDefault();
    const task = todoInput.value.trim();
    if(task === '') return;
    todoData.push({task, completed: false});
    saveTodo();
    renderTodo();
    todoInput.value = '';
    todoInput.focus();
  });
</script>
</body>
</html>

